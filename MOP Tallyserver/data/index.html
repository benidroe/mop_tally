
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!--<link rel="icon" href="/favicon.ico">-->

    <title>mop tally server</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/form-validation.css" rel="stylesheet">
  </head>

  <body class="bg-light">


      <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">mop tally server</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" id="nav_dashboard" href="#">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="nav_tallies">Tallies</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="nav_settings">Settings</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <main role="main" class="container pt-5" >
    <div class="container ">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="assets/logo7272.png" alt="" width="72" height="72">
        <h2>mop tally server</h2>
        <p class="lead">The Tally server provides a built-in web interface that allows you to configure server parameters, set the ATEM connection details, adjust LED brightness, and manage input assignments for all Tally devices.</p>
      </div>

      <div class="row">
        <div class="col-md-4 order-md-2 mb-4">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Tallies available</span>
            <span class="badge badge-secondary badge-pill">12</span>
          </h4>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between lh-condensed" id="vtally1">
              <div>
                <h6 class="my-0">Tally 0x01</h6>
                <small class="text-muted" id="vtallytxt1">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>
            <li class="list-group-item d-flex justify-content-between lh-condensed" id="vtally2">
              <div>
                <h6 class="my-0">Tally 0x02</h6>
                <small class="text-muted" id="vtallytxt2">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>
            <li class="list-group-item d-flex justify-content-between lh-condensed" id="vtally3">
              <div>
                <h6 class="my-0">Tally 0x03</h6>
                <small class="text-muted" id="vtallytxt3">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>
            
            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally4">
              <div>
                <h6 class="my-0">Tally 0x04</h6>
                <small class="text-muted" id="vtallytxt4">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally5">
              <div>
                <h6 class="my-0">Tally 0x05</h6>
                <small class="text-muted" id="vtallytxt5">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally6">
              <div>
                <h6 class="my-0">Tally 0x06</h6>
                <small class="text-muted" id="vtallytxt6">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally7">
              <div>
                <h6 class="my-0">Tally 0x07</h6>
                <small class="text-muted" id="vtallytxt7">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally8">
              <div>
                <h6 class="my-0">Tally 0x08</h6>
                <small class="text-muted" id="vtallytxt8">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally9">
              <div>
                <h6 class="my-0">Tally 0x09</h6>
                <small class="text-muted" id="vtallytxt9">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally10">
              <div>
                <h6 class="my-0">Tally 0x0A</h6>
                <small class="text-muted" id="vtallytxt10">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally11">
              <div>
                <h6 class="my-0">Tally 0x0B</h6>
                <small class="text-muted" id="vtallytxt11">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed " id="vtally12">
              <div>
                <h6 class="my-0">Tally 0x0C</h6>
                <small class="text-muted" id="vtallytxt12">-</small>
              </div>
              <span class="text-muted">-</span>
            </li>

          
            

          </ul>
        </div>
        <div class="col-md-8 order-md-1" id="div_content">
          
        </div>
      </div>
</main>
      <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2025 Medienoperative Ulm e.V.</p>
      </footer>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script src="assets/jquery-3.7.1.js"></script>
    <script>

      var ws = new WebSocket('ws://192.168.0.110/ws');
    ws.onopen = function() {
      console.log("WebSocket connected");
    };
    ws.onmessage = function(event) {
      var obj = jQuery.parseJSON( event.data);
      var pwv = obj.preview;
      var pgm = obj.program;
      for(i = 1; i <= 12; i++){
        $("#vtally"+i).removeClass("list-group-item-danger");
        $("#vtally"+i).removeClass("list-group-item-success");
        $("#vtallytxt"+i).html("-");
        if(pwv[i] == true){
           $("#vtally"+i).addClass("list-group-item-success");
           $("#vtallytxt"+i).html("preview");
        }
        if(pgm[i] == true){
           $("#vtally"+i).addClass("list-group-item-danger");
           $("#vtallytxt"+i).html("program");
        }
        
      }

    };

        $( "#nav_dashboard" ).on( "click", function() {
            $('#div_content').load('dashboard.html');
        } );

        $( "#nav_tallies" ).on( "click", function() {
            $('#div_content').load('tallies.html', function(responseTxt, statusTxt, xhr){
              if(statusTxt == "success")
                 $.getJSON("/tallies", ).done(function(data){
                
                  for (i = 1; i <= 12; i++){
                    document.getElementById("mapx"+i).value = data[i-1];
                  }
          
              });
              $.getJSON("/brightness", ).done(function(data){
                document.getElementById("range-led").value = data.led;
                document.getElementById("range-neopixel").value = data.neopixel;
                
              });

        } ); 
      });


        $( "#nav_settings" ).on( "click", function() {
            $('#div_content').load('settings.html', function(responseTxt, statusTxt, xhr){
              if(statusTxt == "success")
                 $.getJSON("/settings", ).done(function(data){
                 document.getElementById("ip").value = data.ip;
                 document.getElementById("sn").value = data.sn;
                 document.getElementById("gw").value = data.gw;
                 document.getElementById("swip").value = data.atemip;
                 document.getElementById("ch").value = data.espch;
      
          
              });

              


              if(statusTxt == "error")
                alert("Error: " + xhr.status + ": " + xhr.statusText);
            });
          });


            // submit form

          $(document).on('submit', '#settingsform', function(){
                event.preventDefault();                
                var form = document.getElementById('settingsform');
                var formData = new FormData(form);

                setTimeout(
                    function() 
                    {
                      location.reload();
                    }, 1000);
             
                $.ajax({
                    url: '/settings',
                    method: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    
                });
            

          });

              // submit end

              $(document).on('change', '#range-neopixel', function(){
                brightness = this.value;
                $.ajax({
                    url: '/neopixel',
                    method: 'POST',
                    data: 'brightness='+brightness,
                    processData: false,
                    contentType: false,
                    success: function (response) {                      
                        // nothing
                    },
                    error: function (xhr, status, error) {                       
                        alert('Your form was not sent successfully.');
                        console.error(error);
                    }
                });
              });


               $(document).on('change', '#range-led', function(){
                brightness = this.value;
                $.ajax({
                    url: '/led',
                    method: 'POST',
                    data: 'brightness='+brightness,
                    processData: false,
                    contentType: false,
                    success: function (response) {                      
                        // nothing
                    },
                    error: function (xhr, status, error) {                       
                        alert('Your form was not sent successfully.');
                        console.error(error);
                    }
                });
              });



               $(document).on('change', '.tallyrouter', function(){
                var $current = $( this );
                input = $current.val();
                tally = $current.attr("attr_tally");
                $.ajax({
                    url: '/tallyroute',
                    method: 'POST',
                    data: 'input='+input+'&tally='+tally,
                    processData: false,
                    contentType: false,
                    success: function (response) {                      
                        // nothing
                    },
                    error: function (xhr, status, error) {                       
                        alert('Your form was not sent successfully.');
                        console.error(error);
                    }
                });
              });



              $(document).on('click', '#tallysave', function(){
                event.preventDefault();                             
                $.ajax({
                    url: '/tallysave',
                    method: 'POST',
                    data: 'save=true',
                    processData: false,
                    contentType: false,
                    success: function (response) {                      
                        //alert('Your form has been sent successfully.');
                    },
                    error: function (xhr, status, error) {                       
                        alert('Your form was not sent successfully.');
                        console.error(error);
                    }
                });



          });
            
           

  
    </script>

  </body>
</html>
